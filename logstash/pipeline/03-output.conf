# =============================================================================
# Logstash Output Configuration
# =============================================================================
# Slanje obrađenih logova u Elasticsearch
# =============================================================================

output {
  # -------------------------------------------------------------------------
  # Glavni output - Elasticsearch
  # -------------------------------------------------------------------------
  elasticsearch {
    hosts => ["https://elasticsearch:9200"]
    user => "elastic"
    password => "${ELASTIC_PASSWORD}"
    ssl => true
    ssl_certificate_verification => false
    
    # Dinamički index na temelju tipa podataka
    index => "%{[@metadata][beat]}-%{+YYYY.MM.dd}"
    
    # Za aplikacijske logove
    # index => "security-%{+YYYY.MM.dd}"
  }
  
  # -------------------------------------------------------------------------
  # Sigurnosni događaji u zasebni index
  # -------------------------------------------------------------------------
  if [security_category] {
    elasticsearch {
      hosts => ["https://elasticsearch:9200"]
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      ssl => true
      ssl_certificate_verification => false
      index => "security-events-%{+YYYY.MM.dd}"
    }
  }
  
  # -------------------------------------------------------------------------
  # Visoko rizični događaji u zasebni index
  # -------------------------------------------------------------------------
  if [security_severity] == "high" or "potential_log_injection" in [tags] {
    elasticsearch {
      hosts => ["https://elasticsearch:9200"]
      user => "elastic"
      password => "${ELASTIC_PASSWORD}"
      ssl => true
      ssl_certificate_verification => false
      index => "security-alerts-%{+YYYY.MM.dd}"
    }
  }
  
  # -------------------------------------------------------------------------
  # Debug output (opcionalno - zakomentirajte u produkciji)
  # -------------------------------------------------------------------------
  # stdout {
  #   codec => rubydebug
  # }
}
